// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

enum UserStatus {
  ACTIVE
  SUSPENDED
}

enum UserRole {
  SUPERADMIN
  ADMIN
  MEMBER
  FARMMANAGER
}

model User {
  id             Int           @id @default(autoincrement())
  name           String?
  email          String        @unique
  password       String?
  status         UserStatus    @default(ACTIVE)
  role           UserRole      @default(MEMBER)
  image          String?
  imageUrl       String?
  updatedBy      String?
  createdBy      String?
  organisationId Int
  organisation   Organisation  @relation(fields: [organisationId], references: [id], onUpdate: Cascade)
  invite         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  Farm           Farm[]
  FarmManager    FarmManager[]
}

model Organisation {
  id               Int      @id @default(autoincrement())
  image            String?
  imageUrl         String?
  name             String
  // contactNumber    String
  // contactPerson    String
  organisationCode String   @default("")
  organisationType String
  updatedBy        String?
  createdBy        String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  users            User[]
  addressId        String?  @unique
  address          Address? @relation(fields: [addressId], references: [id], onUpdate: Cascade)

  contact             Contact[]
  hatchery            Hatchery[]            @relation("HatcheryCreator")
  fishSupply          FishSupply[]          @relation("fishSupplyCreator")
  Farm                Farm[]
  FeedSupply          FeedSupply[]
  FishSupply          FishSupply[]
  production          production[]
  SamplingEnvironment SamplingEnvironment[]
  SamplingStock       SamplingStock[]

  @@index([createdAt])
  @@index([updatedAt])
  @@index([organisationCode])
}

model Address {
  id       String  @id @default(cuid())
  name     String?
  street   String?
  province String?
  city     String?
  postCode String?
  country  String?

  organisation   Organisation?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organisationId Int?

  @@index([createdAt])
  @@index([updatedAt])
}

model Contact {
  id        String   @id @default(cuid())
  name      String?
  email     String?
  phone     String?
  role      String?
  userId    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation   Organisation? @relation(fields: [organisationId], references: [id])
  organisationId Int?

  @@index([createdAt])
  @@index([updatedAt])
}

model Farm {
  id             String        @id @default(cuid())
  name           String
  farmAltitude   String
  farmAddressId  String?       @unique
  lat            String?
  lng            String?
  farmAddress    FarmAddress?  @relation(fields: [farmAddressId], references: [id], onUpdate: Cascade)
  fishFarmer     String
  updatedBy      String?
  createdBy      String?
  organisationId Int?
  organisation   Organisation? @relation(fields: [organisationId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  productionUnits     ProductionUnit[]
  production          production[]
  User                User?                 @relation(fields: [userId], references: [id])
  userId              Int?
  FarmManager         FarmManager[]
  SamplingEnvironment SamplingEnvironment[]
  SamplingStock       SamplingStock[]

  @@index([createdAt])
  @@index([updatedAt])
}

model FarmAddress {
  id           String  @id @default(cuid())
  addressLine1 String
  addressLine2 String?
  province     String
  city         String
  zipCode      String
  country      String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Farm      Farm?

  @@index([createdAt])
  @@index([updatedAt])
}

model ProductionUnit {
  id            String @id @default(cuid())
  name          String
  type          String
  capacity      String
  waterflowRate String

  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  Farm                Farm?                 @relation(fields: [farmId], references: [id])
  farmId              String?
  production          production[]
  SamplingEnvironment SamplingEnvironment[]
  SamplingStock       SamplingStock[]

  @@index([createdAt])
  @@index([updatedAt])
}

model FeedSupply {
  id                   String        @id @default(cuid())
  feedIngredients      String
  feedingGuide         String
  productionIntensity  String
  unit                 String
  feedingPhase         String
  lifeStage            String
  shelfLife            String
  productCode          String
  feedSupplierCode     String
  brandCode            String
  productNameCode      String
  productFormatCode    String
  animalSizeInLength   String?
  animalSizeInWeight   String?
  specie               String
  nutritionalPurpose   String
  nutritionalClass     String
  particleSize         String
  productFormat        String
  productName          String
  brandName            String
  feedSupplier         String
  nutritionalGuarantee Json
  updatedBy            String?
  createdBy            String?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  organisationId       Int?
  organisation         Organisation? @relation(fields: [organisationId], references: [id])

  @@index([createdAt])
  @@index([updatedAt])
}

model Hatchery {
  id             String        @id @default(cuid())
  name           String
  code           String
  altitude       String
  fishSpecie     String
  createdBy      Int? // Optional field, nullable foreign key
  updatedBy      String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  creator        Organisation? @relation("HatcheryCreator", fields: [createdBy], references: [id]) // Optional relation to User
  organisationId Int?

  @@index([createdAt])
  @@index([updatedAt])
}

model FishSupply {
  id               Int           @id @default(autoincrement())
  batchNumber      String        @default("BB1")
  organisation     Int
  hatchingDate     String
  spawningDate     String
  spawningNumber   Int
  age              String
  broodstockMale   String?
  broodstockFemale String?
  fishFarm         String
  fishFarmId       String        @default("")
  status           String
  productionUnits  String        @default("")
  createdBy        Int? // Optional field, nullable foreign key
  updatedBy        String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  creator          Organisation? @relation("fishSupplyCreator", fields: [createdBy], references: [id])
  organisationId   Int?
  organisationData Organisation? @relation(fields: [organisationId], references: [id])
  production       production[]
  farmMangerId     Int?
  farmManger       FarmManager?  @relation(fields: [farmMangerId], references: [id])

  @@index([createdAt])
  @@index([updatedAt])
}

model WaterQuality {
  id           Int         @id @default(autoincrement())
  currentDate  String?
  waterTemp    String?
  DO           String?
  TSS          String?
  NH4          String?
  NO3          String?
  NO2          String?
  ph           String?
  visibility   String?
  productionId Int?
  production   production? @relation(fields: [productionId], references: [id])
}

model FishSample {
  id           Int         @id @default(autoincrement())
  currentDate  String?
  biomass      String?
  fishCount    String?
  meanLength   String?
  meanWeight   String?
  productionId Int?
  production   production? @relation(fields: [productionId], references: [id])
}

model production {
  id                Int             @id @default(autoincrement())
  fishFarmId        String
  farm              Farm?           @relation(fields: [fishFarmId], references: [id])
  productionUnitId  String
  biomass           String?
  fishCount         String?
  batchNumberId     Int?
  age               String?
  meanLength        String?
  meanWeight        String?
  stockingDensityKG String?
  stockingDensityNM String?
  stockingLevel     String?
  createdBy         Int? // Optional field, nullable foreign key
  updatedBy         String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  organisationId    Int?
  field             String?
  organisation      Organisation?   @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  productionUnit    ProductionUnit? @relation(fields: [productionUnitId], references: [id])
  fishSupply        FishSupply?     @relation(fields: [batchNumberId], references: [id])
  WaterQuality      WaterQuality[]
  FishSample        FishSample[]

  @@index([createdAt])
  @@index([updatedAt])
}

model FarmManager {
  id         Int          @id @default(autoincrement())
  userId     Int?
  user       User?        @relation(fields: [userId], references: [id])
  farmId     String?
  farm       Farm?        @relation(fields: [farmId], references: [id])
  createdBy  Int? // Optional field, nullable foreign key
  updatedBy  String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  FishSupply FishSupply[]

  @@index([createdAt])
  @@index([updatedAt])
}

model SamplingEnvironment {
  id               Int             @id @default(autoincrement())
  fishFarmId       String
  farm             Farm?           @relation(fields: [fishFarmId], references: [id])
  productionUnitId String
  date             String?
  do               String?
  ammonia          String?
  TSS              String?
  createdBy        Int? // Optional field, nullable foreign key
  updatedBy        String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  organisationId   Int?
  organisation     Organisation?   @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  productionUnit   ProductionUnit? @relation(fields: [productionUnitId], references: [id])

  @@index([createdAt])
  @@index([updatedAt])
}

model SamplingStock {
  id               Int             @id @default(autoincrement())
  fishFarmId       String
  farm             Farm?           @relation(fields: [fishFarmId], references: [id])
  productionUnitId String
  biomass          String?
  fishCount        String?
  meanLength       String?
  meanWeight       String?
  createdBy        Int? // Optional field, nullable foreign key
  updatedBy        String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  organisationId   Int?
  organisation     Organisation?   @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  productionUnit   ProductionUnit? @relation(fields: [productionUnitId], references: [id])

  @@index([createdAt])
  @@index([updatedAt])
}
